---
import Heading from "../components/Heading.astro";
import Text from "../components/Text.astro";
import Link from "../components/Link.astro";

// Props interface
export interface Props {
  title: string;
  image: string;
  imageAlt?: string;
  destinations?: Array<{ label: string; locations: string }>;
  duration: string;
  departures: Array<{
    status: "available" | "last_chance" | "sold_out";
    statusText: string;
    statusIcon: string;
    date: string;
    price: string;
  }>;
  link?: string;
}

const {
  title,
  image,
  imageAlt = "Travel destination",
  destinations = [],
  duration,
  departures = [],
  link = "#",
} = Astro.props;
---

<div
  class="bg-[#FBFBFF] rounded-xl p-4 md:p-6 flex flex-col gap-4 w-full max-w-120"
  x-data="{ showList: false }"
>
  <!-- Header with Title and Flip Icon -->
  <div class="flex items-center justify-between gap-4">
    <Heading htmlheading="h5">
      {title}
    </Heading>
    <button @click="showList = !showList" class="flex-shrink-0">
      <img
        src="/src/assets/images/flip.svg"
        alt="Toggle view"
        width="40"
        height="40"
        class="cursor-pointer hover:opacity-80 transition-opacity"
      />
    </button>
  </div>

  <!-- Image / Destination List Toggle -->
  <div class="w-full rounded-2xl overflow-hidden">
    <img
      src={image}
      alt={imageAlt}
      class="w-full h-auto aspect-[35/22] object-cover"
      x-show="!showList"
      x-transition
    />

    <div x-show="showList" x-transition class="bg-white p-4 min-h-[15rem] h-40">
      <div class="space-y-2">
        {
          destinations.map((destination) => (
            <div class="flex place-items-end gap-2">
              <Text type="body_1" weight="bold" stylingclasses="uppercase">
                {destination.label}:
              </Text>
              <Text type="caption">{destination.locations}</Text>
            </div>
          ))
        }
      </div>
    </div>
  </div>

  <!-- Duration -->
  <div>
    <Text stylingclasses="text-lg font-medium">{duration}</Text>
  </div>

  <!-- Grid Board: Status, Departure, Price with aligned rows -->
  <div class="grid grid-cols-3 gap-x-4 gap-y-3">
    <!-- Headers Row -->
    <Text type="body_1" stylingclasses="text-left">Status</Text>
    <Text type="body_1" stylingclasses="text-center">AFREJSE</Text>
    <Text type="body_1" stylingclasses="text-right">PRIS</Text>

    {
      departures.map((departure) => (
        <>
          <div class="flex items-center gap-2 justify-start">
            <img
              src={departure.statusIcon}
              alt=""
              class="w-4 h-4 flex-shrink-0"
            />
            <Text type="body2">{departure.statusText}</Text>
          </div>
          <Text type="body2" stylingclasses="text-center">
            {departure.date}
          </Text>
          <Text type="body2" stylingclasses="text-right">
            {departure.price}
          </Text>
        </>
      ))
    }
  </div>

  <!-- Spacer to push button down -->
  <div class="flex-grow"></div>

  <!-- Read More Button - Full Width -->
  <Link
    variant="card_btn"
    size="large"
    stylingclasses="w-full flex justify-between"
    href={link}
  >
    <Text>LÃ¦s mere</Text>
    <img src="/src/assets/images/nextArrow.svg" alt="" class="w-5 h-5" />
  </Link>
</div>

<script>
  import Alpine from "alpinejs";
  Alpine.start();
</script>
